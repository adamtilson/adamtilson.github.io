<!DOCTYPE html>
<!-- Top Navigation modified from CodingNepal - https://www.codingnepalweb.com/mega-menu-and-dropdown-menu-html-css/ -->
<!-- Side navigation modified from Sticky, Smooth, Active Nav by Chris Coyier https://codepen.io/chriscoyier/pen/qyELzd -->
<!-- Collabsibles from W3Schools https://www.w3schools.com/howto/howto_js_collapsible.asp -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> ENSE 374 Lab 8 </title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/> 
  <link rel="stylesheet" href="/assets/css/style.css?v=">
  <link rel="icon" type="image/svg+xml" href="/assets/svg/at.svg">
  <!-- for mathjax support -->

</head>
<body>
  <nav id="site">
    <div class="wrapper">
      <div class="logo"><a href="#"><img
        src="/assets/svg/at.svg" alt="logo" height="35" width="35" /></a></div>
      <input type="radio" name="slider" id="menu-btn">
      <input type="radio" name="slider" id="close-btn">
      <ul class="nav-links">
        <label for="close-btn" class="btn close-btn"><i class="fas fa-times"></i></label>
        <!-- <li><a href="#">Blog</a></li>
        <li>
          <a href="#" class="desktop-item">CV ▾</a>
          <input type="checkbox" id="showDrop">
          <label for="showDrop" class="mobile-item">CV ▾</label>
          <ul class="drop-menu">
            <li><a href="#">Technical</a></li>
            <li><a href="#">Academic</a></li>
          </ul>
        </li> -->
        <li>
          <a href="#" class="desktop-item">Laboratory ▾</a>
          <input type="checkbox" id="showMega">
          <label for="showMega" class="mobile-item">Laboratory ▾</label>
          <div class="mega-box">
            <div class="content">


              <div class="row">
                <header>ENSE 271</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-271/">Schedule</a></li>
                  <li><a href="/labs/ense-271/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-271/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-271/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-271/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-271/lab-5">Lab 5</a></li>
                  <li><a href="/labs/ense-271/lab-6">Lab 6</a></li>
                  <!-- <li><a href="/labs/ense-271/lab-7">Lab 7</a></li> -->
                </ul>
              </div>

              <!-- <div class="row">
                <header>ENSE 374</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-374/">Schedule</a></li>
                  <li><a href="/labs/ense-374/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-374/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-374/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-374/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-374/lab-5">Lab 5</a></li>
                  <li><a href="/labs/ense-374/lab-6">Lab 6</a></li>
                  <li><a href="/labs/ense-374/lab-7">Lab 7</a></li>
                  <li><a href="/labs/ense-374/lab-8">Lab 8</a></li>
                  <li><a href="/labs/ense-374/lab-9">Lab 9</a></li>
                </ul>
              </div> -->

              <!-- <div class="row">
                <header>ENSE 411</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-411/schedule">Schedule</a></li>
                  <li><a href="/labs/ense-411/lab-0">Lab 0</a></li>
                  <li><a href="/labs/ense-411/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-411/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-411/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-411/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-411/lab-5">Lab 5</a></li>
                </ul>
              </div> -->

              <!-- <div class="row">
                <header>ENSE 472</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-472/">Schedule</a></li>
                  <li><a href="/labs/ense-472/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-472/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-472/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-472/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-472/lab-5">Lab 5</a></li>
                </ul>
              </div> -->
            </div>
          </div>
        </li>
        <li><a href="javascript:void(0);" id="darklink">🌞︎</a></li>
      </ul>
      <label for="menu-btn" class="btn menu-btn"><i class="fas fa-bars"></i></label>
    </div>
  </nav>
  
  <div class="body">
    <nav id="toc-nav">
      <ul id="toc">

      </ul>
    </nav>

    <main id="content" class="main-content" role="main">
        <p></p>
        <h1 id="lab-8-mysql-and-mongodb">Lab 8: MySQL and MongoDB</h1>

<p>ENSE 374 - Software Engineering Management - Laboratory</p>

<p>University of Regina - Engineering and Applied Science - Software Systems Engineering</p>

<p>Lab Instructor: <a href="mailto:Adam.Tilson@uregina.ca">Adam Tilson</a></p>

<hr />

<p><button class="expandall">Collapse All</button></p>
<section id="objective"><button class="collapsible">Objective</button><div class="text-content"><div class="text-inner">

      <p>This lab introduces databases. In particular, we will discuss MySQL, since it is a more structured database language, and then MongoDB which is typically used in Node stack applications.</p>

    </div></div></section>
<section id="equipment"><button class="collapsible">Equipment</button><div class="text-content"><div class="text-inner">

      <p>Computer running Windows, MacOS or Linux, with an Intel or AMD-based processor (x86 or x86-64) with administrator privileges.</p>
      <ul>
        <li>A modern web browser, with a strong preference for Firefox or Chrome</li>
        <li>A text editor, preferably VS Code</li>
      </ul>

    </div></div></section>
<section id="part1sql"><button class="collapsible">Part 1: SQL</button><div class="text-content"><div class="text-inner">

      <p>In this lab we will be using MongoDB as our database. However, to understand MongoDB, it can help to first understand MySQL, a very popular database.</p>

      <p><a href="https://www.w3schools.com/sql/default.asp">Basic tutorial on W3Schools</a></p>

      <p>Trying out SQL:</p>

      <p>Find an online SQL Playground such as <a href="https://sqliteonline.com/">sqlite online</a></p>

      <p>Table</p>

      <table>
        <thead>
          <tr>
            <th>games</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>id</td>
          </tr>
          <tr>
            <td>name</td>
          </tr>
          <tr>
            <td>price</td>
          </tr>
        </tbody>
      </table>

      <p>Rows</p>

      <table>
        <thead>
          <tr>
            <th><em>id</em></th>
            <th>name</th>
            <th>price</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Inscryption</td>
            <td>4.99</td>
          </tr>
        </tbody>
      </table>

      <h3 id="setup">Setup</h3>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">games</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">name</span> <span class="n">STRING</span><span class="p">,</span>
   <span class="n">price</span> <span class="n">MONEY</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <p><img src="res/games.png" alt="" /></p>

      <h3 id="create">Create</h3>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">games</span> <span class="k">VALUES</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="nv">"Inscryption"</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">.</span><span class="mi">99</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <p>To see the results, right click on your table in the left and do a <code class="language-plaintext highlighter-rouge">SELECT (Show table)</code></p>

      <p><img src="res/first-add.png" alt="" /></p>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">games</span><span class="p">(</span>
    <span class="n">id</span><span class="p">,</span>
    <span class="n">name</span>
<span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="nv">"Outlast"</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <p><img src="res/partial-add.png" alt="" /></p>

      <p>This is fine, but you can’t leave out ID!</p>

      <h3 id="read">Read</h3>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">games</span>
</code></pre></div>      </div>

      <p>or</p>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">games</span> <span class="k">WHERE</span> <span class="n">id</span><span class="o">=</span><span class="mi">2</span> 
</code></pre></div>      </div>

      <p><img src="res/select-with-where.png" alt="" /></p>

      <p>There are more fancy comparators too.</p>

      <h3 id="update">Update</h3>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">games</span>
<span class="k">SET</span> <span class="n">price</span> <span class="o">=</span> <span class="mi">22</span><span class="p">.</span><span class="mi">79</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="nv">"Outlast"</span>
</code></pre></div>      </div>

      <p><img src="res/price-update.png" alt="" /></p>

      <p>Adding Columns?</p>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">games</span>
<span class="k">ADD</span> <span class="n">rating</span> <span class="nb">INT</span>
</code></pre></div>      </div>

      <p><img src="res/alter.png" alt="" /></p>

      <p>No default, gotta go back and add them! Can you update to:</p>

      <table>
        <thead>
          <tr>
            <th><em>id</em></th>
            <th>name</th>
            <th>price</th>
            <th>rating</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Inscryption</td>
            <td>4.99</td>
            <td>85</td>
          </tr>
          <tr>
            <td>2</td>
            <td>Outlast</td>
            <td>22.79</td>
            <td>80</td>
          </tr>
        </tbody>
      </table>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">games</span>
<span class="k">SET</span> <span class="n">rating</span> <span class="o">=</span> <span class="mi">80</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="nv">"Outlast"</span>

</code></pre></div>      </div>

      <p><img src="res/rating-updates.png" alt="" /></p>

      <h3 id="delete">Delete</h3>

      <p>Dangerous, don’t run without a WHERE, or you could remove all rows!</p>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">games</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="nv">"Outlast"</span>
</code></pre></div>      </div>

      <p>better</p>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">games</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre></div>      </div>

      <h3 id="relationships">Relationships</h3>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">ratings</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">game_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">review</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">game_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">games</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <p><img src="res/ratings.png" alt="" /></p>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">ratings</span> <span class="k">VALUES</span> <span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="nv">"An ordinary card game, nothing strange happening here"</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">games</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">games</span><span class="p">.</span><span class="n">rating</span><span class="p">,</span> <span class="n">ratings</span><span class="p">.</span><span class="n">review</span>
<span class="k">FROM</span> <span class="n">ratings</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">games</span> <span class="k">ON</span> <span class="n">ratings</span><span class="p">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="n">id</span>
</code></pre></div>      </div>

      <p><img src="res/inner-join.png" alt="" /></p>

    </div></div></section>
<section id="part2nosqlandmongodb"><button class="collapsible">Part 2: NoSQL and MongoDB</button><div class="text-content"><div class="text-inner">

      <h3 id="sql-vs-nosql">SQL vs NoSQL</h3>

      <p>Structured Query Language vs. Not only Structure Query Language</p>
      <ul>
        <li>SQL: MySQL, PostgreSQL</li>
        <li>NoSQL: Mongo, Redis</li>
      </ul>

      <table>
        <thead>
          <tr>
            <th>SQL</th>
            <th>NoSQL</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Old Reliable</td>
            <td>New and Cool</td>
          </tr>
          <tr>
            <td>Tables</td>
            <td>Collections</td>
          </tr>
          <tr>
            <td>Records / Rows</td>
            <td>Documents</td>
          </tr>
          <tr>
            <td>Schema Enforced</td>
            <td>Schema Optional</td>
          </tr>
          <tr>
            <td>Relational!</td>
            <td>Only kinda relational</td>
          </tr>
          <tr>
            <td>Scales Vertically</td>
            <td>Scales Horizontally</td>
          </tr>
        </tbody>
      </table>

      <p>Comparable to C++ vs JavaScript objects - in C++ all fields must be filled, in JavaScript it can be ad-hoc.</p>

      <h3 id="installation">Installation</h3>

      <p>This procedure will discuss Windows. Download the Community Server from their website…</p>

      <p><img src="res/download.png" alt="" /></p>

      <p><img src="res/download-2.png" alt="" /></p>

      <p>Download the MSI. (420 MB)</p>
      <ul>
        <li>Run it…
          <ul>
            <li><code class="language-plaintext highlighter-rouge">Complete</code> Install.</li>
            <li>Install as a Network Service User</li>
            <li>Do not Install Mongo Compass</li>
            <li>Reboot is required…
              <ul>
                <li>I will let you back in.</li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>

      <p><img src="res/install-config.png" alt="" /></p>

      <p><strong>Keep track of these directories, we’ll need them in a bit!</strong></p>

      <p><img src="res/no-compass.png" alt="" /></p>

      <p>Starting in V6, we will need a second utility to access the database through the command line, which is called <code class="language-plaintext highlighter-rouge">mongosh</code>, the mongo db shell</p>

      <p><a href="https://www.mongodb.com/try/download/shell">Download mongosh here</a></p>

      <p>I recommend unzipping this and copying the files in the <code class="language-plaintext highlighter-rouge">bin</code> folder into <code class="language-plaintext highlighter-rouge">C:\Program Files\MongoDB\Server\6.0\bin</code></p>

      <p>Make an Alias file:</p>

      <p>Open powershell and open your powershell profile:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>notepad $profile
</code></pre></div>      </div>

      <p>If you get an error that the path doesn’t exist, then you can create it with:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-item -Path $profile -ItemType File -Force
</code></pre></div>      </div>

      <p>Then attempt to open the file again.</p>

      <p>Now paste in:</p>

      <p>(Note, your directories may be different than mine! Keep track in the previous section!)</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set-Alias mongod "C:\Program Files\MongoDB\Server\6.0\bin\mongod.exe"
Set-Alias mongosh "C:\Program Files\MongoDB\Server\6.0\bin\mongosh.exe"
</code></pre></div>      </div>

      <p>Save, close, and restart powershell.</p>

      <p>If you get text warning you you can’t run scripts, you will need to:</p>

      <ul>
        <li>Open a powershell as an administrator</li>
        <li>Run the following:
          <ul>
            <li><code class="language-plaintext highlighter-rouge">Set-ExecutionPolicy Unrestricted</code></li>
            <li>Restart all powershell instances</li>
          </ul>
        </li>
      </ul>

      <p>Alternatively, in the lab, from the powershell you could instead run:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&amp; 'C:\Program Files\MongoDB\Server\6.0\bin\mongosh.exe'
</code></pre></div>      </div>

      <!-- Create a data directory -->

      <!-- create the folders: -->

      <!-- `c:/data` -->

      <!-- and -->

      <!-- `c:/data/db` -->

      <!-- This is where your databases will be stored. -->

      <p>Check it is working with:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongosh --version
</code></pre></div>      </div>

      <p><img src="res/working-on-windows.png" alt="" /></p>

      <p><em>** Important **</em>
In the lab, note that anything you put in the database will be accessible to other users who sign on to the computer. Please cleanup your databases when done!</p>

      <h3 id="installation-guides">Installation guides</h3>

      <p><a href="https://docs.mongodb.com/manual/administration/install-on-linux/">Linux</a>
<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/">Ubuntu</a>
<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x">Mac</a>
<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-windows/">Windows</a></p>

      <h3 id="mongod">mongod</h3>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">mongod</code> is the mongo demon</li>
        <li>If you installed as a Service in windows, you won’t need to manually run this
          <ul>
            <li>In the lab it will be running automatically</li>
          </ul>
        </li>
        <li>When run manually, the default data directory is <code class="language-plaintext highlighter-rouge">c:\data\db</code>. If this directory doesn’t exist, it will exit.</li>
        <li>As long as the mongo service is running, it will allow connections from a client on 27017</li>
        <li>On linux, you typically need to run it as <code class="language-plaintext highlighter-rouge">sudo</code></li>
        <li>To connect to the database, open a second terminal, and run <code class="language-plaintext highlighter-rouge">mongosh</code>, the Mongo shell</li>
      </ul>

      <h3 id="help">Help</h3>

      <p>To show help, run…</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>help
</code></pre></div>      </div>

      <h3 id="mongo-shell">Mongo shell</h3>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongosh
</code></pre></div>      </div>

      <ul>
        <li>Command line application to perform database operations</li>
      </ul>

      <h3 id="the-database-db">The Database (db)</h3>

      <p>The largest data structure in mongo db is a database (db). These are further composed of collections which is further composed of documents. We can compare this to SQL:</p>

      <table>
        <thead>
          <tr>
            <th>sql</th>
            <th>mongo</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>database</td>
            <td>db</td>
          </tr>
          <tr>
            <td>table</td>
            <td>collection</td>
          </tr>
          <tr>
            <td>row</td>
            <td>document</td>
          </tr>
        </tbody>
      </table>

      <p>To show databases:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show dbs
</code></pre></div>      </div>

      <p>Mostly these will just be the defaults to start.</p>

      <h3 id="creating-a-database">Creating a database</h3>

      <p>We can create or use a db with…</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use testdb
</code></pre></div>      </div>

      <p>However, if we check it again with…</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show dbs
</code></pre></div>      </div>

      <ul>
        <li>The database still hasn’t created until we add a document</li>
        <li>Unlike in MySQL where everything is created first and then objects are stored, NoSQL is more ad-hoc, with containers only appearing once they contain data.</li>
      </ul>

      <p>Check the current db with…</p>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db
</code></pre></div>      </div>

      <h3 id="collection">Collection</h3>

      <p>These are like tables in SQL</p>
      <ul>
        <li>a collection of documents
          <ul>
            <li>where documents are like table rows or records</li>
          </ul>
        </li>
      </ul>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show collections
</code></pre></div>      </div>

      <p>However, we haven’t created the collection yet!</p>
      <ul>
        <li>Again, it’s ad-hoc.
          <ul>
            <li>We need to insert a document into the collection in order to create it.</li>
          </ul>
        </li>
      </ul>

    </div></div></section>
<section id="part3mongodbcrudoperations"><button class="collapsible">Part 3: Mongo DB CRUD Operations</button><div class="text-content"><div class="text-inner">

      <p>Common database operations are defined by the acronym <code class="language-plaintext highlighter-rouge">CRUD</code>: Create, Read, Update, Delete</p>

      <p><a href="https://docs.mongodb.com/manual/crud/">Read the Manual!</a></p>
      <ul>
        <li>Adam’s Docs review: actually pretty good!</li>
      </ul>

      <h3 id="create-1">CREATE</h3>

      <p>You can insert elements into the database with the following functions:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">collections</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span> <span class="p">...</span> <span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">collections</span><span class="p">.</span><span class="nx">insertMany</span><span class="p">(</span> <span class="p">...</span> <span class="p">);</span>
</code></pre></div>      </div>

      <p>The parameters are javascript objects.</p>

      <p>e.g.</p>
      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">4.99</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <h3 id="read-1">READ</h3>

      <p>To find an element from our collection, use:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
</code></pre></div>      </div>

      <p>Which shows all of the games.</p>

      <p>We can also pass a json object into find( … ) to only match certain criteria.</p>
      <ul>
        <li>returns “Projections” - slices of the collection which contain only the relevant data!</li>
      </ul>

      <p><a href="https://docs.mongodb.com/manual/reference/operator/query/">Query Selectors let you find objects based on Comparisons</a></p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nl">price</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> 
</code></pre></div>      </div>

      <p>Note the funky nested object syntax!</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div>      </div>

      <p>Note the following, which will return nothing:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">price</span><span class="p">:</span> <span class="p">{</span><span class="na">$lt</span><span class="p">:</span> <span class="mf">2.00</span><span class="p">}</span> <span class="p">})</span>
</code></pre></div>      </div>

      <table>
        <thead>
          <tr>
            <th>operator</th>
            <th>use</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>$eq</td>
            <td>Matches values that are equal to a specified value.</td>
          </tr>
          <tr>
            <td>$gt</td>
            <td>Matches values that are greater than a specified value.</td>
          </tr>
          <tr>
            <td>$gte</td>
            <td>Matches values that are greater than or equal to a specified value.</td>
          </tr>
          <tr>
            <td>$in</td>
            <td>Matches any of the values specified in an array.</td>
          </tr>
          <tr>
            <td>$lt</td>
            <td>Matches values that are less than a specified value.</td>
          </tr>
          <tr>
            <td>$lte</td>
            <td>Matches values that are less than or equal to a specified value.</td>
          </tr>
          <tr>
            <td>$ne</td>
            <td>Matches all values that are not equal to a specified value.</td>
          </tr>
          <tr>
            <td>$nin</td>
            <td>Matches none of the values specified in an array.</td>
          </tr>
          <tr>
            <td>$and</td>
            <td>Joins query clauses with a logical AND returns all documents that match the conditions of both clauses.</td>
          </tr>
          <tr>
            <td>$not</td>
            <td>Inverts the effect of a query expression and returns documents that do not match the query expression.</td>
          </tr>
          <tr>
            <td>$nor</td>
            <td>Joins query clauses with a logical NOR returns all documents that fail to match both clauses.</td>
          </tr>
          <tr>
            <td>$or</td>
            <td>Joins query clauses with a logical OR returns all documents that match the conditions of either clause.</td>
          </tr>
        </tbody>
      </table>

      <h3 id="update-1">UPDATE</h3>

      <p>We need to use syntax similar to Find to find the document we want to update, and then we can add a new record as needed</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span> <span class="p">},</span> 
                   <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">price</span><span class="p">:</span> <span class="mf">2.99</span> <span class="p">}</span> <span class="p">});</span>
</code></pre></div>      </div>

      <h3 id="delete-1">DELETE</h3>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
</code></pre></div>      </div>

      <p>We can also remove an existing database with the following command:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">dropDatabase</span><span class="p">();</span>
</code></pre></div>      </div>

    </div></div></section>
<section id="part4relationships"><button class="collapsible">Part 4: Relationships</button><div class="text-content"><div class="text-inner">

      <p>A common practice in databases design, to avoid redundancy, is for a document to reference to a second document for more information. These secondary documents can be either embedded, such that the entire entry exists each place it is needed, or referenced, so that only a single referenced document exists which can be referenced multiple times.</p>

      <p>There are several types of relationships:</p>

      <p>One-to-One</p>
      <ul>
        <li>If each user has exactly one unique game, you could use an embedded approach</li>
      </ul>

      <p>One-to-Many</p>
      <ul>
        <li>If one game has many reviews, it may make sense to use the embedded document approach.</li>
      </ul>

      <p>Many-to-Many</p>
      <ul>
        <li>If many users have many games, and vice versa
          <ul>
            <li>A reference approach is preferred</li>
          </ul>
        </li>
      </ul>

      <h3 id="embedded">Embedded</h3>

      <p>Example, we can create reviews in array notation:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">4.99</span><span class="p">,</span>
        <span class="na">reviews</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="na">userName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">James Games</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">rating</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="na">review</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Too short</span><span class="dl">"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="na">userName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Robin Speedruns</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">rating</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="na">review</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Classic</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <h3 id="reference">Reference</h3>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">insertMany</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">userName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">James Games</span><span class="dl">"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="na">userName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Robin Speedruns</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">);</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">4.99</span><span class="p">,</span>
        <span class="na">reviews</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="na">user_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="na">rating</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="na">review</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Too short</span><span class="dl">"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="na">user_id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="na">rating</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="na">review</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Classic</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>      </div>

      <p>To cross reference between the tables, we need to use the $lookup command:</p>

      <p>We could match the user to the review by looking up in both tables:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> 
    <span class="na">_id</span><span class="p">:</span> <span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">find</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">reviews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">user_id</span>
<span class="p">})</span>
</code></pre></div>      </div>

      <p>Note: This syntax is no longer working in Version 7.0, instead you should use findOne</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> 
    <span class="na">_id</span><span class="p">:</span> <span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">findOne</span><span class="p">().</span><span class="nx">reviews</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">user_id</span>
<span class="p">})</span>
</code></pre></div>      </div>

      <h3 id="schemas">Schemas</h3>

      <p>If the ad-hoc nature of MongoDB is too frustrating for you, you can also define schemas, which are more like table templates</p>
      <ul>
        <li>list the fields that you need</li>
        <li>list dataTypes for those fields</li>
        <li>list of those fields are required</li>
        <li>list default values for them</li>
        <li>You can do this in Mongo, but instead we’ll look at this in Mongoose in just a bit!</li>
      </ul>

    </div></div></section>
<section id="part5mongoose"><button class="collapsible">Part 5: Mongoose</button><div class="text-content"><div class="text-inner">

      <p>Mongoose is a Node.js library for connecting to your database, and performing database operations. It can be triggered by any code in your Node.js script, but you will most likely want to use it on your routes.</p>

      <p><em>If you aren’t running Mongo as a service on startup, make sure <code class="language-plaintext highlighter-rouge">mongod</code> is running!</em></p>

      <h3 id="what-is-it">What is it?</h3>

      <p>The default driver for mongo for Node.js is a little bit tedious.</p>
      <ul>
        <li>A theme in this class is introducing tools to make your life easier</li>
        <li>These are also widely used in Industry</li>
      </ul>

      <h3 id="installation-1">Installation</h3>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i mongoose
</code></pre></div>      </div>

      <h3 id="boilerplate">Boilerplate</h3>

      <p>Modified from the front page:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Bring in mongoose</span>
<span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="dl">'</span><span class="s1">mongoose</span><span class="dl">'</span> <span class="p">);</span>

<span class="c1">// connects to the "test" database (ensure mongod is running!)</span>
<span class="c1">// the later arguments fix some deprecation warnings</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span> <span class="dl">'</span><span class="s1">mongodb://localhost:27017/test</span><span class="dl">'</span><span class="p">,</span> 
                  <span class="p">{</span> <span class="na">useNewUrlParser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">useUnifiedTopology</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>

<span class="c1">// create a schema</span>
<span class="kd">const</span> <span class="nx">Cat</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span> <span class="dl">'</span><span class="s1">Cat</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nb">String</span> <span class="p">});</span>

<span class="c1">// create a document following that schema</span>
<span class="kd">const</span> <span class="nx">kitty</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cat</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Zildjian</span><span class="dl">'</span> <span class="p">});</span>
<span class="nx">kitty</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">meow</span><span class="dl">'</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div>      </div>
      <p>That’s all it takes to do database stuff from Node! Let’s look at these in more depth…</p>

      <h3 id="creating-a-schema">Creating a Schema</h3>

      <p>Creating a schema for our game example:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">gameSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span> <span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">rating</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span>
    <span class="na">price</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span>
    <span class="na">review</span><span class="p">:</span> <span class="nb">String</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>There are explicit data types assigned, as in SQL. These are called SchemaTypes. <a href="https://mongoosejs.com/docs/guide.html">Read the docs for more info!</a></p>

      <p>Types:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">String</code></li>
        <li><code class="language-plaintext highlighter-rouge">Number</code></li>
        <li><code class="language-plaintext highlighter-rouge">Date</code></li>
        <li><code class="language-plaintext highlighter-rouge">Buffer</code></li>
        <li><code class="language-plaintext highlighter-rouge">Boolean</code></li>
        <li><code class="language-plaintext highlighter-rouge">Mixed</code></li>
        <li><code class="language-plaintext highlighter-rouge">ObjectId</code></li>
        <li><code class="language-plaintext highlighter-rouge">Array</code></li>
        <li><code class="language-plaintext highlighter-rouge">Decimal128</code></li>
        <li><code class="language-plaintext highlighter-rouge">Map</code></li>
      </ul>

      <p>If you omit _id, then Mongoose will add it for as a unique ObjectID. Or you can be explicit, but you must ALWAYS set one, or it will not save.</p>

      <h3 id="using-a-collection">Using a Collection</h3>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// this creates a collection called `games` (Weird, but intuitive)</span>
<span class="kd">const</span> <span class="nx">Game</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span> <span class="p">(</span> <span class="dl">"</span><span class="s2">Game</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gameSchema</span> <span class="p">);</span>
</code></pre></div>      </div>

      <h3 id="adding-a-document">Adding a Document</h3>

      <p>We want to add a new game document to our games collection</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">rating</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="na">price</span><span class="p">:</span> <span class="mf">4.99</span><span class="p">,</span>
    <span class="na">review</span><span class="p">:</span> <span class="dl">"</span><span class="s2">classic</span><span class="dl">"</span>
<span class="p">});</span>

<span class="nx">game</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</code></pre></div>      </div>

      <p>Typically you run this once from a node.js script, and then comment out the save lines to prevent multiple identical copies of things in your DB!</p>
      <ul>
        <li>You likely won’t want nodemon running here when doing database tests, instead just use <code class="language-plaintext highlighter-rouge">node app.js</code>
          <ul>
            <li>Otherwise every time you do an update, expect more copies in the database!</li>
          </ul>
        </li>
      </ul>

      <p>Also, make sure you have <code class="language-plaintext highlighter-rouge">mongod</code> server running in a separate terminal!</p>

      <p>Let’s use mongo shell and find our game. From a separate terminal</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongo
use test
db.games.find()
</code></pre></div>      </div>

      <p>A few extra entries were added, but it’s basically what we expect:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">games</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="p">{</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="dl">"</span><span class="s2">617747c24de34db695e58f96</span><span class="dl">"</span><span class="p">),</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="dl">"</span><span class="s2">price</span><span class="dl">"</span> <span class="p">:</span> <span class="mf">4.99</span><span class="p">,</span> <span class="dl">"</span><span class="s2">review</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">classic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">__v</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>

</code></pre></div>      </div>

      <h3 id="mongoose-help">Mongoose Help</h3>

      <p><a href="https://mongoosejs.com/docs/guide.html">The docs. That are… just okay.</a></p>

      <h3 id="important-aside-async-javascript">Important Aside: Async Javascript</h3>

      <ul>
        <li>In modern JavaScript, it’s important to write non-blocking code
          <ul>
            <li>i.e., if an operation is slow, rather than waiting for it, we can allow other operations go first
              <ul>
                <li>e.g. Database operations take time, especially for big databases on slow hard drives!</li>
              </ul>
            </li>
          </ul>
        </li>
        <li><code class="language-plaintext highlighter-rouge">async</code> is a modern JavaScript keyword that allows this
          <ul>
            <li>Signified by a function with the <code class="language-plaintext highlighter-rouge">async</code> keyword</li>
            <li>Rather than returning a value, it returns a “promise” that it will return a value, once it completes.</li>
          </ul>
        </li>
        <li>Previously, once the operation is complete, you can resume execution via a callback function
          <ul>
            <li>In much the same way in JavaScript DOM we used callbacks to wait for a user to click a button, and then did something</li>
            <li>In this case we are waiting for the database to read, and then do something in a callback
              <ul>
                <li>The problem - what if you need to wait for one thing, which waits for another things, which waits for another</li>
                <li>It can lead to nested callbacks and callback hell</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>Thus, we’ll make use of the <code class="language-plaintext highlighter-rouge">async</code>/<code class="language-plaintext highlighter-rouge">await</code> syntax.
          <ul>
            <li>This code reads like it’s synchronous, but it’s not</li>
            <li>I think it leads to cleaner code, better for when learning.</li>
          </ul>
        </li>
      </ul>

      <p><em>The reason we are forced to look at this is now is: Mongoose has no synchronous API! We have to use async, either through callbacks, promises, or async/await</em></p>

      <h3 id="reading-from-a-mongodb">Reading from a MongoDB</h3>

      <p>Here’s doing a find operation using callback syntax:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Game</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span> <span class="p">},</span> <span class="p">(</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">results</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">results</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="dl">"</span><span class="s2">no results found</span><span class="dl">"</span> <span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// this is where we have access to our results</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Or we can use the <code class="language-plaintext highlighter-rouge">async</code>/<code class="language-plaintext highlighter-rouge">await</code> syntax.</p>
      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">findInDatabase</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span> <span class="p">});</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="dl">"</span><span class="s2">no results founds</span><span class="dl">"</span> <span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// this is where we have access to our results</span>
        
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">findInDatabase</span><span class="p">();</span>
</code></pre></div>      </div>

      <p>While these may seem similar, if you are doing repeated calls which require the results of multiple functions, your code can get very deeply nested in the callback approach.</p>

      <p>Enough syntax talk, what does our code actually do?</p>

      <ul>
        <li>returns an array of our games in a JavaScript object called ‘results’
          <ul>
            <li>We can traverse it just like any other JS Object</li>
            <li>Can we use <code class="language-plaintext highlighter-rouge">for...of</code> loops? Yep!</li>
            <li>Can we pass it to EJS and use it there? Yep!</li>
          </ul>
        </li>
      </ul>

      <h3 id="closing-the-connection">Closing the connection</h3>

      <p>The last time you use Mongoose, you should close the connection</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</code></pre></div>      </div>
      <ul>
        <li>e.g. in the last find callback.</li>
        <li>In our server operations, the server will stay open, so we don’t need to explicitly close</li>
      </ul>

      <h3 id="update-2">Update</h3>

      <p>Here we can do an async update by creating an async anonymous function and immediately calling it:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span> <span class="p">{</span> <span class="na">gameName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Resident Evil 4</span><span class="dl">"</span><span class="p">},</span> 
                              <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">rating</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">});</span>
        <span class="k">await</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span> <span class="p">{</span> <span class="na">gameName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Resident Evil 4</span><span class="dl">"</span><span class="p">},</span> 
                              <span class="p">{</span> <span class="na">$set</span><span class="p">:</span> <span class="p">{</span> <span class="na">review</span><span class="p">:</span> <span class="dl">"</span><span class="s2">I like the original more</span><span class="dl">"</span> <span class="p">}</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">})();</span>
</code></pre></div>      </div>

      <p>This is an example where the await syntax avoided us nesting callbacks</p>

      <h3 id="delete-2">Delete</h3>

      <p>Back to callback syntax:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Game</span><span class="p">.</span><span class="nx">deleteOne</span> <span class="p">(</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Inscryption</span><span class="dl">"</span> <span class="p">},</span> <span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>There is also a deleteMany function.</p>

      <h3 id="adding-relationships">Adding Relationships</h3>

      <p>To add a relationship, we need to create a schema</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">personSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span> <span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">age</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span>
    <span class="na">favouriteGame</span><span class="p">:</span> <span class="nx">gameSchema</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>The syntax makes it appear as if we are embedding a document, but it’s actually a reference. Neat!</p>

    </div></div></section>
<section id="part6fullexample"><button class="collapsible">Part 6: Full example</button><div class="text-content"><div class="text-inner">

      <p>Let’s create a form for users to rate games. Users can enter their name, the game name, score, and rating text. They will then be taken to a page that lists all scores.</p>

      <p>Project setup:</p>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eg-mongoose
|- index.html
|- app.js
|- views
    |- reviews.ejs
</code></pre></div>      </div>

      <p>initializing commands</p>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm init
npm i express ejs
</code></pre></div>      </div>

      <p>and, lets add some text to:</p>

      <p><code class="language-plaintext highlighter-rouge">index.html</code></p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Add Reviews<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/submit"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"userName"</span><span class="nt">&gt;</span>User Name<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"userName"</span> <span class="na">id=</span><span class="s">"userName"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"gameName"</span><span class="nt">&gt;</span>Game Name<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"gameName"</span> <span class="na">id=</span><span class="s">"gameName"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"score"</span><span class="nt">&gt;</span>Score<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"score"</span> <span class="na">id=</span><span class="s">"score"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"reviewText"</span><span class="nt">&gt;</span>Review Text<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"reviewText"</span> <span class="na">id=</span><span class="s">"reviewText"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>      </div>

      <p><code class="language-plaintext highlighter-rouge">reviews.ejs</code></p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>All Reviews<span class="nt">&lt;/title&gt;</span>
    <span class="c">&lt;!-- Styles from w3Schools table tutorial --&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nt">table</span> <span class="p">{</span>
          <span class="nl">font-family</span><span class="p">:</span> <span class="n">arial</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
          <span class="nl">border-collapse</span><span class="p">:</span> <span class="nb">collapse</span><span class="p">;</span>
          <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="nt">td</span><span class="o">,</span> <span class="nt">th</span> <span class="p">{</span>
          <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#dddddd</span><span class="p">;</span>
          <span class="nl">text-align</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
          <span class="nl">padding</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="nt">tr</span><span class="nd">:nth-child</span><span class="o">(</span><span class="nt">even</span><span class="o">)</span> <span class="p">{</span>
          <span class="nl">background-color</span><span class="p">:</span> <span class="m">#dddddd</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th&gt;</span>User Name<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>Game Name<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>Score<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>Review Text<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
        <span class="c">&lt;!-- We want to repeat this for each game in the database --&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>Adam<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>Limbo<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>5<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>Couldn't beat the part with the blow darts.<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="c">&lt;!-- End repeating bit --&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>      </div>

      <p><code class="language-plaintext highlighter-rouge">app.js</code></p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span> <span class="dl">"</span><span class="s2">express</span><span class="dl">"</span> <span class="p">);</span>

<span class="c1">// this is a canonical alias to make your life easier, like jQuery to $.</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span> 
<span class="c1">// a common localhost test port</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span> 

<span class="c1">// body-parser is now built into express!</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span> <span class="p">);</span> 
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span> <span class="dl">"</span><span class="s2">view engine</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ejs</span><span class="dl">"</span> <span class="p">);</span>

<span class="c1">// Simple server operation</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span> <span class="p">(</span> <span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// template literal</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span> <span class="s2">`Server is running on http://localhost:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span> <span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="dl">"</span><span class="s2">A user is accessing the root route using get</span><span class="dl">"</span> <span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/index.html</span><span class="dl">"</span> <span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span> <span class="dl">"</span><span class="s2">/reviews</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="dl">"</span><span class="s2">A user is accessing the reviews route using get</span><span class="dl">"</span> <span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span> <span class="dl">"</span><span class="s2">reviews</span><span class="dl">"</span> <span class="p">);</span> <span class="c1">//pass data to EJS from the Database here</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span> <span class="dl">"</span><span class="s2">/submit</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="dl">"</span><span class="s2">A user is posting data to the submit route</span><span class="dl">"</span> <span class="p">);</span>
    <span class="c1">//write and update the Database here</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span> <span class="dl">"</span><span class="s2">/reviews</span><span class="dl">"</span> <span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>We need to:</p>
      <ol>
        <li>Add the database boilerplate</li>
        <li>Add a schema</li>
        <li>Capture data from the form and store it in the database</li>
        <li>Read from the database and send it to EJS
          <ul>
            <li>Do this in two places</li>
          </ul>
        </li>
        <li>In EJS render all of the data</li>
      </ol>

      <h3 id="add-database-boilerplate">Add database boilerplate</h3>

      <ul>
        <li>add mongoose with <code class="language-plaintext highlighter-rouge">npm i mongoose</code></li>
        <li>in requires:
          <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="dl">"</span><span class="s2">mongoose</span><span class="dl">"</span> <span class="p">);</span>
<span class="c1">// connect to mongoose on port 27017</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span> <span class="dl">"</span><span class="s2">mongodb://localhost:27017/games</span><span class="dl">"</span><span class="p">,</span> 
                <span class="p">{</span> <span class="na">useNewUrlParser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> 
                  <span class="na">useUnifiedTopology</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
</code></pre></div>          </div>
        </li>
      </ul>

      <h3 id="add-a-schema">Add a schema</h3>

      <p>After connecting, add the following code:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// create a mongoose schema for a game</span>
<span class="kd">const</span> <span class="nx">gameSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span> <span class="p">({</span>
    <span class="na">userName</span><span class="p">:</span>   <span class="nb">String</span><span class="p">,</span>
    <span class="na">gameName</span><span class="p">:</span>   <span class="nb">String</span><span class="p">,</span>
    <span class="na">score</span><span class="p">:</span>      <span class="nb">Number</span><span class="p">,</span>
    <span class="na">reviewText</span><span class="p">:</span> <span class="nb">String</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">Game</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span> <span class="p">(</span> <span class="dl">"</span><span class="s2">Game</span><span class="dl">"</span><span class="p">,</span> <span class="nx">gameSchema</span> <span class="p">);</span>
</code></pre></div>      </div>

      <h3 id="capture-form-data-into-the-database">Capture form data into the database</h3>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// save into the database on post</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span> <span class="dl">"</span><span class="s2">/submit</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="dl">"</span><span class="s2">A user is posting the following review</span><span class="dl">"</span> <span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span> <span class="p">)</span>

    <span class="kd">const</span> <span class="nx">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Game</span><span class="p">({</span>
        <span class="na">userName</span><span class="p">:</span>   <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">userName</span><span class="p">,</span>
        <span class="na">gameName</span><span class="p">:</span>   <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">gameName</span><span class="p">,</span>
        <span class="na">score</span><span class="p">:</span>      <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">score</span> <span class="p">),</span>
        <span class="na">reviewText</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">reviewText</span>
    <span class="p">});</span>

    <span class="nx">game</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span> <span class="dl">"</span><span class="s2">/reviews</span><span class="dl">"</span> <span class="p">)</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h3 id="read-from-the-database-and-send-it-to-ejs">Read from the database and send it to EJS</h3>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span> <span class="dl">"</span><span class="s2">/reviews</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="dl">"</span><span class="s2">A user is accessing the reviews route using get, and found the following:</span><span class="dl">"</span> <span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">results</span> <span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span> <span class="dl">"</span><span class="s2">reviews</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">results</span><span class="p">:</span> <span class="nx">results</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h3 id="post-it-using-ejs">Post it using EJS</h3>

      <p>Let’s iterate over the results:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">&lt;!-- We want to repeat this for each game in the database --&gt;</span>
    <span class="nt">&lt;</span><span class="err">%</span> <span class="na">for</span> <span class="err">(</span> <span class="na">const</span> <span class="na">result</span> <span class="na">of</span> <span class="na">results</span> <span class="err">)</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;</span><span class="err">%=</span> <span class="na">result.userName</span> <span class="err">%</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;</span><span class="err">%=</span> <span class="na">result.gameName</span> <span class="err">%</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;</span><span class="err">%=</span> <span class="na">result.score</span> <span class="err">%</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;</span><span class="err">%=</span> <span class="na">result.reviewText</span> <span class="err">%</span><span class="nt">&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- End repeating bit --&gt;</span>
</code></pre></div>      </div>

    </div></div></section>
<section id="labassignment"><button class="collapsible">Lab Assignment</button><div class="text-content"><div class="text-inner">

      <p>The penultimate lab assignment, which will due by demo next week, is to:</p>

      <ul>
        <li>
          <p>Have MongoDB and Mongoose installed on your local machine</p>
        </li>
        <li>Based on your application at the end of lab 7, create Mongoose schemas for:
          <ul>
            <li>Your users</li>
            <li>Your tasks</li>
          </ul>
        </li>
        <li>Additionally, create code to populate your starter users and tasks into the database from the previous lab
          <ul>
            <li>Create the schema objects and save them.</li>
          </ul>
        </li>
        <li>You do not need to completely get all of the functionality of your application working with MongoDB / Mongoose, though that will be part of the final big submission next week, so if you have extra time you could work on that too.
          <ul>
            <li>If you were careful with your model in the last lab, this shouldn’t take too much work to change!</li>
          </ul>
        </li>
      </ul>
    </div></div></section>

    </main>

  </div>
  <footer>
    2022 Adam Tilson.
    <a href="https://creativecommons.org/licenses/by-nc-sa/2.0/"
      >CC-BY-NC-SA</a
    >
  </footer>
  <button onclick="topFunction()" id="topButton" title="Go to top">▲ Top</button> 
  <script src="/assets/js/script.js"></script>

</body>
</html>
