<!DOCTYPE html>
<!-- Top Navigation modified from CodingNepal - https://www.codingnepalweb.com/mega-menu-and-dropdown-menu-html-css/ -->
<!-- Side navigation modified from Sticky, Smooth, Active Nav by Chris Coyier https://codepen.io/chriscoyier/pen/qyELzd -->
<!-- Collabsibles from W3Schools https://www.w3schools.com/howto/howto_js_collapsible.asp -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> ENSE 374 Lab 7 </title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/> 
  <link rel="stylesheet" href="/assets/css/style.css?v=">
  <link rel="icon" type="image/svg+xml" href="/assets/svg/at.svg">
  <!-- for mathjax support -->

</head>
<body>
  <nav id="site">
    <div class="wrapper">
      <div class="logo"><a href="#"><img
        src="/assets/svg/at.svg" alt="logo" height="35" width="35" /></a></div>
      <input type="radio" name="slider" id="menu-btn">
      <input type="radio" name="slider" id="close-btn">
      <ul class="nav-links">
        <label for="close-btn" class="btn close-btn"><i class="fas fa-times"></i></label>
        <!-- <li><a href="#">Blog</a></li>
        <li>
          <a href="#" class="desktop-item">CV ▾</a>
          <input type="checkbox" id="showDrop">
          <label for="showDrop" class="mobile-item">CV ▾</label>
          <ul class="drop-menu">
            <li><a href="#">Technical</a></li>
            <li><a href="#">Academic</a></li>
          </ul>
        </li> -->
        <li>
          <a href="#" class="desktop-item">Laboratory ▾</a>
          <input type="checkbox" id="showMega">
          <label for="showMega" class="mobile-item">Laboratory ▾</label>
          <div class="mega-box">
            <div class="content">


              <div class="row">
                <header>ENSE 271</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-271/">Schedule</a></li>
                  <li><a href="/labs/ense-271/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-271/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-271/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-271/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-271/lab-5">Lab 5</a></li>
                  <li><a href="/labs/ense-271/lab-6">Lab 6</a></li>
                  <!-- <li><a href="/labs/ense-271/lab-7">Lab 7</a></li> -->
                </ul>
              </div>

              <!-- <div class="row">
                <header>ENSE 374</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-374/">Schedule</a></li>
                  <li><a href="/labs/ense-374/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-374/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-374/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-374/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-374/lab-5">Lab 5</a></li>
                  <li><a href="/labs/ense-374/lab-6">Lab 6</a></li>
                  <li><a href="/labs/ense-374/lab-7">Lab 7</a></li>
                  <li><a href="/labs/ense-374/lab-8">Lab 8</a></li>
                  <li><a href="/labs/ense-374/lab-9">Lab 9</a></li>
                </ul>
              </div> -->

              <!-- <div class="row">
                <header>ENSE 411</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-411/schedule">Schedule</a></li>
                  <li><a href="/labs/ense-411/lab-0">Lab 0</a></li>
                  <li><a href="/labs/ense-411/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-411/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-411/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-411/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-411/lab-5">Lab 5</a></li>
                </ul>
              </div> -->

              <!-- <div class="row">
                <header>ENSE 472</header>
                <ul class="mega-links">
                  <li><a href="/labs/ense-472/">Schedule</a></li>
                  <li><a href="/labs/ense-472/lab-1">Lab 1</a></li>
                  <li><a href="/labs/ense-472/lab-2">Lab 2</a></li>
                  <li><a href="/labs/ense-472/lab-3">Lab 3</a></li>
                  <li><a href="/labs/ense-472/lab-4">Lab 4</a></li>
                  <li><a href="/labs/ense-472/lab-5">Lab 5</a></li>
                </ul>
              </div> -->
            </div>
          </div>
        </li>
        <li><a href="javascript:void(0);" id="darklink">🌞︎</a></li>
      </ul>
      <label for="menu-btn" class="btn menu-btn"><i class="fas fa-bars"></i></label>
    </div>
  </nav>
  
  <div class="body">
    <nav id="toc-nav">
      <ul id="toc">

      </ul>
    </nav>

    <main id="content" class="main-content" role="main">
        <p></p>
        <h1 id="lab-7-ejs-and-templates">Lab 7: EJS And Templates</h1>

<p>ENSE 374 - Software Engineering Management - Laboratory</p>

<p>University of Regina - Engineering and Applied Science - Software Systems Engineering</p>

<p>Lab Instructor: <a href="mailto:Adam.Tilson@uregina.ca">Adam Tilson</a></p>

<hr />

<p><button class="expandall">Collapse All</button></p>
<section id="objective"><button class="collapsible">Objective</button><div class="text-content"><div class="text-inner">

      <p>This lab introduces EJS, a Node.js library for Embedded JavaScript Templates. With this, we will be able to create Templated HTML files which will contain placeholders for different variables. These variables will be automatically filled from the Express Server using Node.js. Additionally, we can create reusable chunks of files, called Partials, that can be dynamically inserted into pages.</p>

    </div></div></section>
<section id="equipment"><button class="collapsible">Equipment</button><div class="text-content"><div class="text-inner">

      <p>Computer running Windows, MacOS or Linux, with an Intel or AMD-based processor (x86 or x86-64) with administrator privileges.</p>
      <ul>
        <li>A modern web browser, with a strong preference for Firefox or Chrome</li>
        <li>A text editor, preferably VS Code</li>
      </ul>

    </div></div></section>
<section id="part1introtoejs"><button class="collapsible">Part 1: Intro to EJS</button><div class="text-content"><div class="text-inner">

      <p>Recall our stack, as well as our progress so far…</p>

      <p><img src="res/node-stack.svg" alt="node stack" /></p>

      <p>So far we understand how all of the files on the front end work, as well as how those files get passed over from server. We also looked at how data can be passed to the server with forms, and echoed back from Node.js with and using Express <code class="language-plaintext highlighter-rouge">res.send</code>. However, we would rather place that data into mostly complete HTML files, and we do not have a method for this yet.</p>

      <h3 id="template-processing">Template Processing</h3>

      <p>In the previous lab, we used <code class="language-plaintext highlighter-rouge">express</code> to answer requests and send data back to the client using <code class="language-plaintext highlighter-rouge">res.send</code> and <code class="language-plaintext highlighter-rouge">res.sendfile</code>.</p>

      <p>Either we could build the entire HTML page from scratch using <code class="language-plaintext highlighter-rouge">res.send</code> and HTML tags, or send a completed page with <code class="language-plaintext highlighter-rouge">res.sendfile</code>.</p>

      <p>What if we want to send mostly complete HTML files where only small parts of them get changed, for example a name or a form?</p>

      <h3 id="example-set-up">Example Set Up</h3>

      <p>Let’s continue from our example from last week. To be on the same page…</p>

      <ul>
        <li>create the following files:</li>
      </ul>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ejs-eg
  |-- public
  |    |-- css
  |         |-- style.css
  |-- app.js
  |-- index.html
</code></pre></div>      </div>

      <ul>
        <li>open a terminal in <code class="language-plaintext highlighter-rouge">ejs-eg</code> folder</li>
        <li>type in <code class="language-plaintext highlighter-rouge">npm init</code>
          <ul>
            <li>Accept the defaults (press enter many times)</li>
          </ul>
        </li>
        <li>type in <code class="language-plaintext highlighter-rouge">npm i express</code> (<code class="language-plaintext highlighter-rouge">npm i</code> is shorthand for <code class="language-plaintext highlighter-rouge">npm install</code>)</li>
        <li>add the following code to each file:</li>
      </ul>

      <p>in <code class="language-plaintext highlighter-rouge">index.html</code></p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>A Sample Page<span class="nt">&lt;/title&gt;</span>
    <span class="c">&lt;!-- Recall static resource links are relative to the `public` folder--&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/style.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"my-heading"</span><span class="nt">&gt;</span>This is a heading with a bold background color<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"my-name"</span><span class="nt">&gt;</span>Your Name:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"my-name"</span> <span class="na">id=</span><span class="s">"my-name"</span> <span class="na">placeholder=</span><span class="s">"Your name here"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Submit Your name"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>      </div>

      <p>in <code class="language-plaintext highlighter-rouge">style.css</code></p>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.my-heading</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#97b498</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.error-heading</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#ba6b6c</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>in <code class="language-plaintext highlighter-rouge">app.js</code></p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span> <span class="dl">"</span><span class="s2">express</span><span class="dl">"</span> <span class="p">);</span>

<span class="c1">// this is a canonical alias to make your life easier, like jQuery to $.</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span> 
<span class="c1">// host static resources</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="dl">"</span><span class="s2">public</span><span class="dl">"</span><span class="p">));</span>
<span class="c1">// body-parser is now built into express!</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span> 

<span class="c1">// a common localhost test port</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span> 

<span class="c1">// Simple server operation</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span> <span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// template literal</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="s2">`Server is running on http://localhost:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/index.html</span><span class="dl">"</span><span class="p">);</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// template literal</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span> <span class="p">(</span><span class="s2">`&lt;h1&gt;Welcome to my page, </span><span class="p">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="dl">"</span><span class="s2">my-name</span><span class="dl">"</span><span class="p">]}</span><span class="s2">&lt;/h1&gt;`</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>      </div>

      <p>You can run your application with</p>

      <p><code class="language-plaintext highlighter-rouge">node app.js</code></p>

      <p>or</p>

      <p><code class="language-plaintext highlighter-rouge">npx nodemon</code></p>

      <p>and then visit your webpage by opening your browser and navigating to:</p>

      <p><code class="language-plaintext highlighter-rouge">http://localhost:3000</code></p>

      <p>Add some text to the textbox, submit, and verify everything works.</p>

      <h3 id="installing-ejs">Installing EJS</h3>

      <p>You can install EJS with:</p>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install ejs
</code></pre></div>      </div>

      <p>You can bring it into your express app with:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">view engine</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ejs</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div>      </div>

      <p>Remember to call this after you set app to <code class="language-plaintext highlighter-rouge">express</code>!</p>

    </div></div></section>
<section id="part2ejstemplatesandsendingvariables"><button class="collapsible">Part 2: EJS Templates and sending variables</button><div class="text-content"><div class="text-inner">

      <h3 id="creating-an-ejs-templated-html-file">Creating an ejs templated HTML file</h3>

      <p>Your EJS files need to be put in a special directory:</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/views
</code></pre></div>      </div>

      <p>So, our main file is typically called: <code class="language-plaintext highlighter-rouge">/views/index.ejs</code>, but we can have others too, like <code class="language-plaintext highlighter-rouge">/views/greeting.ejs</code>.</p>

      <p>Let’s create a <code class="language-plaintext highlighter-rouge">/views/greeting.ejs</code>.</p>

      <p>These files are mostly HTML files, e.g. add the following to <code class="language-plaintext highlighter-rouge">/views/greeting.ejs</code>:</p>
      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>A Greeting Page<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/style.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"my-heading"</span><span class="nt">&gt;</span>Welcome to my page, User!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>      </div>

      <p>We can preview this page by adding:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/greeting</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">"</span><span class="s2">greeting</span><span class="dl">"</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p><code class="language-plaintext highlighter-rouge">res.render</code> means to render using the EJS view engine
<code class="language-plaintext highlighter-rouge">"greeting"</code> means look for a file in called <code class="language-plaintext highlighter-rouge">/views/greeting.ejs</code></p>

      <p>And then browsing to <a href="http://localhost:3000/greeting">http://localhost:3000/greeting</a></p>

      <p>Wouldn’t it be nice if we could personalize our page with our User’s name?</p>

      <h3 id="variable-templates">Variable templates</h3>

      <p>In your EJS file, where you want a passed variable to be rendered, you use this syntax:</p>
      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%= variable %&gt;
</code></pre></div>      </div>

      <p>In the <code class="language-plaintext highlighter-rouge">/views/greeting.ejs</code> file:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>A Greeting Page<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/style.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"my-heading"</span><span class="nt">&gt;</span>Welcome to my page, <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">username</span> <span class="err">%</span><span class="nt">&gt;</span>!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>      </div>

      <p>All of the variables you want to render you need to pass from the server, otherwise you’ll get an error!</p>

      <h3 id="send-variables-to-the-template">Send Variables to the Template</h3>

      <p>Rather than using send, Passing a variable to a template using the following syntax:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/greeting</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">"</span><span class="s2">greeting</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Adam</span><span class="dl">"</span><span class="p">})</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p><code class="language-plaintext highlighter-rouge">res.render</code> means to render using the EJS view engine
<code class="language-plaintext highlighter-rouge">"greeting"</code> means look for a file in called <code class="language-plaintext highlighter-rouge">/views/greeting.ejs</code>
The second argument is a JavaScript object of name, value pairs, in this case:</p>
      <ul>
        <li><code class="language-plaintext highlighter-rouge">username</code> is the variable in the EJS file</li>
        <li><code class="language-plaintext highlighter-rouge">Adam</code> is what we wish to write there</li>
      </ul>

      <p>And when we preview our page, now our username will be displayed!</p>

      <p>We can pass over any sort of JavaScript object, and access the variables inside using the appropriate properties!</p>

      <p>Challenge: Modify your starting code so that when the user enters a name on the index page and submits, they are redirected to the greeting page where the name is displayed.</p>

      <p>Solution, in <code class="language-plaintext highlighter-rouge">app.js</code>:</p>
      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span> <span class="dl">"</span><span class="s2">express</span><span class="dl">"</span> <span class="p">);</span>

<span class="c1">// this is a canonical alias to make your life easier, like jQuery to $.</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span> 
<span class="c1">// host static resources</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="dl">"</span><span class="s2">public</span><span class="dl">"</span><span class="p">));</span>
<span class="c1">// body-parser is now built into express!</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span> 

<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">view engine</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ejs</span><span class="dl">"</span><span class="p">);</span>


<span class="c1">// a common localhost test port</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span> 

<span class="c1">// Simple server operation</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span> <span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// template literal</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="s2">`Server is running on http://localhost:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/index.html</span><span class="dl">"</span><span class="p">);</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="mi">307</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/greeting</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/greeting</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">"</span><span class="s2">greeting</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="dl">"</span><span class="s2">my-name</span><span class="dl">"</span><span class="p">]})</span>
<span class="p">});</span>

</code></pre></div>      </div>

    </div></div></section>
<section id="part3ejscontrolcode"><button class="collapsible">Part 3: EJS Control Code</button><div class="text-content"><div class="text-inner">

      <p>Sending individual variables is useful, but we can actually do more with EJS. We can use EJS Control Structures, and also pass over Arrays and loop through the contents!</p>

      <p>Control structures are similar in syntax to JavaScript, though not all of the functionality exists. Each <code class="language-plaintext highlighter-rouge">scriptlet</code> line is wrapped in <code class="language-plaintext highlighter-rouge">&lt;% %&gt;</code> tags.</p>

      <p>Eg. we can have a conditions:</p>

      <p>In <code class="language-plaintext highlighter-rouge">/views/greeting.ejs</code>, replace:</p>
      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"my-heading"</span><span class="nt">&gt;</span>Welcome to my page, <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">username</span> <span class="err">%</span><span class="nt">&gt;</span>!<span class="nt">&lt;/h1&gt;</span>
</code></pre></div>      </div>

      <p>with:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%</span> <span class="na">if</span> <span class="na">(username =</span><span class="s">==</span> <span class="err">"</span><span class="na">Adam</span><span class="err">")</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"my-heading"</span><span class="nt">&gt;</span>Welcome to my page, <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">username</span> <span class="err">%</span><span class="nt">&gt;</span>!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="na">else</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"error-heading"</span><span class="nt">&gt;</span> Sorry, I don't know you <span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div>      </div>

      <p>We can also use loops:</p>

      <p>e.g. looping and rendering items in an array:</p>

      <p>in your express route…</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">apples</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">orange</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">peach</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">mango</span><span class="dl">"</span><span class="p">];</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">"</span><span class="s2">greeting</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="dl">"</span><span class="s2">my-name</span><span class="dl">"</span><span class="p">],</span> 
                            <span class="na">fruitList</span><span class="p">:</span> <span class="nx">fruits</span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>in your <code class="language-plaintext highlighter-rouge">views/greeting.ejs</code>, after your greeting:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>My favourite fruits are:<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;</span><span class="err">%</span> <span class="na">for</span> <span class="err">(</span><span class="na">let</span> <span class="na">i = </span><span class="s">0;</span> <span class="na">i</span> <span class="err">&lt;</span> <span class="na">fruitList.length</span><span class="err">;</span> <span class="na">i</span><span class="err">++)</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span> <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">fruitList</span><span class="err">[</span><span class="na">i</span><span class="err">]</span> <span class="err">%</span><span class="nt">&gt;</span> <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div>      </div>

      <p>Other loop structures are available as well.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>My favourite fruits are:<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="na">for</span> <span class="err">(</span><span class="na">let</span> <span class="na">fruit</span> <span class="na">of</span> <span class="na">fruitList</span><span class="err">)</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span> <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">fruit</span> <span class="err">%</span><span class="nt">&gt;</span> <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div>      </div>

    </div></div></section>
<section id="part4layoutsandpartials"><button class="collapsible">Part 4: Layouts and Partials</button><div class="text-content"><div class="text-inner">

      <h3 id="static-components-layouts">Static components: Layouts</h3>

      <p>If you have common static components you wish to use on many pages, e.g. a header or a footer, you can create an EJS layout to include this component.</p>

      <p>e.g. in <code class="language-plaintext highlighter-rouge">/views/layouts/header.ejs</code></p>
      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>A Greeting Page<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/style.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
</code></pre></div>      </div>

      <p>and in <code class="language-plaintext highlighter-rouge">/views/layouts/footer.ejs</code></p>
      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>2022 BY-NC-SA<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>      </div>

      <p>To include this in another page, add the following snippets where you want these components to appear:</p>

      <p>e.g. The new entire contents of <code class="language-plaintext highlighter-rouge">views/greeting.ejs</code>:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">("</span><span class="na">layouts</span><span class="err">/</span><span class="na">header</span><span class="err">")</span> <span class="na">-</span><span class="err">%</span><span class="nt">&gt;</span>

<span class="nt">&lt;</span><span class="err">%</span> <span class="na">if</span> <span class="na">(username =</span><span class="s">==</span> <span class="err">"</span><span class="na">Adam</span><span class="err">")</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"my-heading"</span><span class="nt">&gt;</span>Welcome to my page, <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">username</span> <span class="err">%</span><span class="nt">&gt;</span>!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="na">else</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"error-heading"</span><span class="nt">&gt;</span> Sorry, I don't know you <span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>

<span class="nt">&lt;p&gt;</span>My favourite fruits are:<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="na">for</span> <span class="err">(</span><span class="na">let</span> <span class="na">fruit</span> <span class="na">of</span> <span class="na">fruitList</span><span class="err">)</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span> <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">fruit</span> <span class="err">%</span><span class="nt">&gt;</span> <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">("</span><span class="na">layouts</span><span class="err">/</span><span class="na">footer</span><span class="err">")</span> <span class="na">-</span><span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div>      </div>

      <p>You can include boilerplate code, css, javascript, whatever you need, so that only the content for that page remains. This is super slick and highly recommended!</p>

      <p>This paradigm is used heavily in and expanded on in front-end frameworks like React and Vue, which unfortunately we don’t cover in this course.</p>

      <h3 id="dynamic-components-partials">Dynamic Components: Partials</h3>

      <p>Partials are similar to layouts, except you can pass through parameters to further modify them at render time.</p>

      <p>In other words, the variables which are passed to your EJS page from express, can then be further passed to a partial.</p>

      <p>These are saved in:</p>

      <p><code class="language-plaintext highlighter-rouge">/views/partials/</code></p>

      <p>e.g. <code class="language-plaintext highlighter-rouge">/views/partials/list-module.ejs</code></p>

      <p>Call it with</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">("</span><span class="na">partials</span><span class="err">/</span><span class="na">list-module.ejs</span><span class="err">",</span> <span class="err">{</span> <span class="na">itemList</span> <span class="na">:</span> <span class="na">fruits</span> <span class="err">})</span> <span class="na">-</span><span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div>      </div>

      <p>example:</p>

      <p>in <code class="language-plaintext highlighter-rouge">/views/partials/list-module.ejs</code></p>
      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;</span><span class="err">%</span> <span class="na">for</span> <span class="err">(</span><span class="na">let</span> <span class="na">item</span> <span class="na">of</span> <span class="na">itemList</span><span class="err">)</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span> <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">item</span> <span class="err">%</span><span class="nt">&gt;</span> <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div>      </div>

      <p>and our final <code class="language-plaintext highlighter-rouge">views/greetings.ejs</code>:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">("</span><span class="na">layouts</span><span class="err">/</span><span class="na">header</span><span class="err">")</span> <span class="na">-</span><span class="err">%</span><span class="nt">&gt;</span>

<span class="nt">&lt;</span><span class="err">%</span> <span class="na">if</span> <span class="na">(username =</span><span class="s">==</span> <span class="err">"</span><span class="na">Adam</span><span class="err">")</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"my-heading"</span><span class="nt">&gt;</span>Welcome to my page, <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">username</span> <span class="err">%</span><span class="nt">&gt;</span>!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="na">else</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"error-heading"</span><span class="nt">&gt;</span> Sorry, I don't know you <span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="err">}</span> <span class="err">%</span><span class="nt">&gt;</span>

<span class="nt">&lt;p&gt;</span>My favourite fruits are:<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">("</span><span class="na">partials</span><span class="err">/</span><span class="na">list-module.ejs</span><span class="err">",</span> <span class="err">{</span> <span class="na">itemList</span> <span class="na">:</span> <span class="na">fruitList</span> <span class="err">})</span> <span class="na">-</span><span class="err">%</span><span class="nt">&gt;</span>

<span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">("</span><span class="na">layouts</span><span class="err">/</span><span class="na">footer</span><span class="err">")</span> <span class="na">-</span><span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div>      </div>

      <p>Challenge: Can you do the same with the Welcome module?</p>

      <h3 id="total-data-flow">Total Data Flow</h3>

      <p><img src="res/total-data-flow.png" alt="" /></p>

    </div></div></section>
<section id="part5themodel"><button class="collapsible">Part 5: The Model</button><div class="text-content"><div class="text-inner">

      <p>In lab 5, if you did not successfully separate your model from your view, you likely struggled with your understanding of what a task is, conceptually.</p>
      <ul>
        <li>Is it a DOM element? The text inside an input box?</li>
        <li>How do I tell what state the task is in?
          <ul>
            <li>I have to look at surrounding DOM elements to see if there is a button or a checkbox or both?</li>
          </ul>
        </li>
        <li>This is confusing and hard!
          <ul>
            <li>And any solutions you come up with for working with them seem very hacky!</li>
          </ul>
        </li>
      </ul>

      <p><img src="res/what-is-a-task.png" alt="" /></p>

      <p>This struggle showcases the difficulty when your <code class="language-plaintext highlighter-rouge">model</code> is not separated from your <code class="language-plaintext highlighter-rouge">view</code>!</p>

      <p>Let’s think about the data which is used to describe a task:</p>

      <ul>
        <li>What order the task are tasks displayed in?</li>
        <li>What state is the task in?</li>
        <li>What is the text of the task?</li>
        <li>Who made the task?</li>
        <li>Has anyone claimed the task?
          <ul>
            <li>If so, who claimed the task?</li>
          </ul>
        </li>
        <li>Is the task done?
          <ul>
            <li>Is the task cleared?</li>
          </ul>
        </li>
      </ul>

      <p>We can describe this data as an Object, using <code class="language-plaintext highlighter-rouge">UML Class Diagram</code> notation:</p>

      <p><img src="res/class-diagram.png" alt="" /></p>

      <p>With this in your mind, you can be thinking:</p>

      <p><img src="res/model-vs-view.png" alt="" /></p>

    </div></div></section>
<section id="labassignment"><button class="collapsible">Lab Assignment</button><div class="text-content"><div class="text-inner">

      <p>In this lab you will implement the remaining functionality of the application, but without the added security and database operations which we will discuss in the following weeks. In place of this, we will simply read from and write to JSON files. Consider this lab a learning exercise on using node and passing data with the controller: not everything we do will be best practices and should not be followed in production environments!</p>

      <p><img src="res/jquery.svg" alt="" /></p>

      <p>Note that this application forks from lab 3, most of the JQuery JavaScript (Front End functionality) will be removed from the application in favour of back end functionality. However, the logic may be similar, depending on you implemented it.</p>

      <h3 id="data-setup---the-model">Data setup - The Model</h3>

      <p>Later on, we will store our model in a database. Right now, we’ll just create some JavaScript objects to represent both the user and the tasks, and store them in there. The classes should be created as follows:</p>

      <p><code class="language-plaintext highlighter-rouge">User</code> object:</p>
      <ul>
        <li>username (string)</li>
        <li>password (string)</li>
      </ul>

      <p><code class="language-plaintext highlighter-rouge">Task</code> object:</p>
      <ul>
        <li>_id (int) - assign sequential numbers, must be unique</li>
        <li>text (string)</li>
        <li>state (string)</li>
        <li>creator (User)</li>
        <li>isTaskClaimed (boolean)</li>
        <li>claimingUser (User)</li>
        <li>isTaskDone (boolean)</li>
        <li>isTaskCleared (boolean)</li>
      </ul>

      <p>Create an array of each type of object</p>
      <ul>
        <li>Have an array of two <code class="language-plaintext highlighter-rouge">Users</code></li>
        <li>Have an array of five <code class="language-plaintext highlighter-rouge">Tasks</code></li>
        <li>The tasks must be:
          <ul>
            <li>1 unclaimed task</li>
            <li>1 claimed by user1 and unfinished</li>
            <li>1 claimed by user2 and unfinished</li>
            <li>1 claimed by user1 and finished</li>
            <li>1 claimed by user2 and finished</li>
          </ul>
        </li>
      </ul>

      <p>For unclaimed tasks, the <code class="language-plaintext highlighter-rouge">claimingUser</code> should be <code class="language-plaintext highlighter-rouge">null</code></p>

      <p>Additionally, create functions for saving and loading each array to or from a <code class="language-plaintext highlighter-rouge">.json</code> file, then save them.</p>
      <ul>
        <li>Save them once, them comment out the function call
          <ul>
            <li>Only save again if something changes in the lists</li>
          </ul>
        </li>
        <li>On future runs, load the existing lists (the saved ones) rather than the ones in your code!</li>
        <li>Whenever you perform an operation which would read from the Model, load the JSON first.</li>
        <li>Whenever you perform an operation which updates the Model, write to the JSON file. This way they remain synchroized!</li>
      </ul>

      <p>** Note: It is extremely insecure to save user passwords in plain text objects. Do not use any realistic passwords for any accounts! We will make this more secure in Lab 4! **</p>

      <h3 id="faq---how-do-i-store-an-array-into-a-json-file">FAQ - How do I store an array into a JSON file?</h3>

      <p>Use syntax similar to:</p>
      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="dl">"</span><span class="s2">employees</span><span class="dl">"</span><span class="p">:[</span>    
    <span class="p">{</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Ram</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">ram@gmail.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">age</span><span class="dl">"</span><span class="p">:</span><span class="mi">23</span><span class="p">},</span>    
    <span class="p">{</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Shyam</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">shyam23@gmail.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">age</span><span class="dl">"</span><span class="p">:</span><span class="mi">28</span><span class="p">},</span>  
    <span class="p">{</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">John</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">john@gmail.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">age</span><span class="dl">"</span><span class="p">:</span><span class="mi">33</span><span class="p">},</span>    
    <span class="p">{</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Bob</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">bob32@gmail.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">age</span><span class="dl">"</span><span class="p">:</span><span class="mi">41</span><span class="p">}</span>   
<span class="p">]}</span> 
</code></pre></div>      </div>

      <p><a href="https://www.javatpoint.com/json-array">Source</a></p>

      <h3 id="user-registration-and-login">User registration and login</h3>

      <p>Render the login page on the <code class="language-plaintext highlighter-rouge">/</code> route.</p>

      <p>Give the following functionality to the login page:</p>

      <p>Link the login form to the “/login” route with POST. In this route perform the following:</p>
      <ul>
        <li>check through the user list to see if the entered username is registered</li>
        <li>if so, check if the user’s password matches the password for the entry</li>
        <li>if so, redirect the user with the POST variables to the “/todo” route.</li>
      </ul>

      <p>Link the register form to the “/register” route. In this route perform the following:</p>
      <ul>
        <li>ensure that the sign up <code class="language-plaintext highlighter-rouge">authorization</code> field matches a constant value of <code class="language-plaintext highlighter-rouge">todo2022</code></li>
        <li>check that no users exists with the username entered</li>
        <li>If no users with that name exist, create a new user with the username and password supplied</li>
        <li>finally, redirect with the POST variables to the “/todo” route.</li>
      </ul>

      <p><em>Be sure to save the updated user list to the JSON file when a user registers</em></p>

      <h3 id="faq">FAQ</h3>

      <p>How do I do a redirect which maintains the form data from one route to another?</p>

      <p>Use this syntax:</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span> <span class="mi">307</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/newroute</span><span class="dl">"</span> <span class="p">);</span>
</code></pre></div>      </div>

      <p>In order for this to work, you need to have properly configured express to pass arguments like body-parser.</p>

      <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span> 
</code></pre></div>      </div>

      <p>Make sure this code runs before any <code class="language-plaintext highlighter-rouge">app.listen</code>, <code class="language-plaintext highlighter-rouge">app.post</code> or <code class="language-plaintext highlighter-rouge">app.get</code> calls!</p>

      <h3 id="to-do-list-display">To-do list display</h3>

      <p>Use EJS to render the to-do list on the “/todo” route</p>

      <p>When rendering the route, ensure the following data is passed to the EJS file</p>
      <ul>
        <li>the logged in user’s username (string)</li>
        <li>the list of tasks (array)</li>
      </ul>

      <p>On the todo list, render the following:</p>
      <ul>
        <li>The logout block</li>
        <li>The to-do list display</li>
        <li>Each of the different task states:
          <ul>
            <li>Recall the starting state of the Task list includes one of each:
              <ul>
                <li>Unclaimed</li>
                <li>Claimed by the current user but unfinished</li>
                <li>Claimed by the current user and finished</li>
                <li>Claimed by a different user but unfinished</li>
                <li>Claimed by a different user and finished</li>
              </ul>
            </li>
            <li>Use EJS Partials to render each of these as partials</li>
          </ul>
        </li>
        <li>A section for adding new tasks</li>
        <li>A button for removing complete tasks</li>
      </ul>

      <p>Any Task flagged as “cleared” should not be displayed</p>

      <p>The Tasks should be decorated as in the previous labs.</p>

      <p>Hints:</p>

      <ul>
        <li>Think about the total flow of the data, from the Model to the View
          <ul>
            <li>Loading in the data from the JSON</li>
            <li>Passing it to an EJS file through Express</li>
            <li>Loop through the array using an appropriate control structure</li>
            <li>For each task…
              <ul>
                <li>(optional) pass it in to an appropriate partial</li>
                <li>Use that partial to render the task correctly, modified from code you created earlier
                  <ul>
                    <li>You may need to look at task properties, and the username, and compare it to the logged in user</li>
                  </ul>
                </li>
                <li>Wrap the code in a form which can be submitted to an appropriate route</li>
              </ul>
            </li>
            <li>In the submission route, unpack the data submitted</li>
            <li>Use the data submitted to update the model appropriate</li>
          </ul>
        </li>
      </ul>

      <p>More Hints:</p>

      <ul>
        <li>when adding a task to the page, use a <code class="language-plaintext highlighter-rouge">hidden</code> HTML virtuinput element to contain the task’s _id to uniquely identify it</li>
        <li>You can submit a form when a checkbox is clicked using <code class="language-plaintext highlighter-rouge">&lt;input onChange="this.form.submit()" ... 
  /&gt;</code></li>
        <li>You can use a <code class="language-plaintext highlighter-rouge">hidden</code> input type to store the username of the currently logged in user.
          <ul>
            <li>This will automatically pass it back to Node.js when you submit as a POST parameter</li>
          </ul>
        </li>
      </ul>

      <p>** Note: Storing the current user in POST and passing it around via redirects works, but it’s not best practice. In Lab 9 we’ll replace this functionality with sessions**</p>

      <h3 id="to-do-list-functionality">To-do list functionality</h3>

      <p>Finally, code up all of the routes to give your application functionality
Name your routes, use the methods, and implement as follows:</p>

      <table>
        <thead>
          <tr>
            <th>route</th>
            <th>method</th>
            <th>purpose</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>/logout</td>
            <td>get</td>
            <td>logs out the user and returns to the main screen</td>
          </tr>
          <tr>
            <td>/addtask</td>
            <td>post</td>
            <td>adds a new unclaimed task to the task list, and redirects to “/todo”</td>
          </tr>
          <tr>
            <td>/claim</td>
            <td>post</td>
            <td>claims the task for the user who clicks on the claim button, and redirects back to “/todo”</td>
          </tr>
          <tr>
            <td>/abandonorcomplete</td>
            <td>post</td>
            <td>checks if the user clicked on abandon or complete, updates the task appropriately, and redirects to “/todo”</td>
          </tr>
          <tr>
            <td>/unfinish</td>
            <td>post</td>
            <td>for the selected task, sets the task state to unfinished, and redirects back to “/todo”</td>
          </tr>
          <tr>
            <td>/purge</td>
            <td>post</td>
            <td>Set all tasks where “done” is true such that “cleared” is true. and redirects back to “/todo”</td>
          </tr>
        </tbody>
      </table>

      <p>The following state diagram represents state transition for tasks owned by the currently signed in user:</p>

      <p><img src="res/state-diagram.png" alt="" /></p>

      <h3 id="submission">Submission</h3>

      <p>Please submit to URCourses by the due date.</p>
    </div></div></section>

    </main>

  </div>
  <footer>
    2022 Adam Tilson.
    <a href="https://creativecommons.org/licenses/by-nc-sa/2.0/"
      >CC-BY-NC-SA</a
    >
  </footer>
  <button onclick="topFunction()" id="topButton" title="Go to top">▲ Top</button> 
  <script src="/assets/js/script.js"></script>

</body>
</html>
